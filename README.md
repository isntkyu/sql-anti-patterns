# sql-anti-patterns
SQL AntiPatterns - Bill Karwin


![스크린샷 2023-10-22 오후 11 23 50](https://github.com/isntkyu/sql-anti-patterns/assets/56504493/51ca2218-b0b0-4ef2-99b7-adf4eb99e831)


---

# 무단횡단

일대다 관계 테이블의 요구사항이 다대다로 바뀐 상황.
한 컬럼에 쉼표로 이어진 다중 값 속성을 사용한다.
> 건너기만 하면 된다는 무단횡단에 비유

이러면 안되는 이유
- 조회시 패턴매칭해야함 > 인덱스 안탐
- 집계함수 못씀
- 정렬도 안됨
- 수정이 복잡함
- 유효성 검증이 안됨
- 구분자를 절대 쓰이지 않을 문자로 해야함
- 길이(항목수) 제한이 있다

```
결론
중간 테이블을 써야함
```

--- 
# 순진한트리  

데이터의 재귀적 관계

계층 구조를 만들때는 모든자식을 한번에 조회할수있는지 체크해야한다

1. parent_id 컬럼을 추가하는 방법 (인접목록)
	1. 조인의 개수만큼의 뎁스의자식만 가져올 수 있다 (동적으로 조인추가가 안되니깐)
	2. select 컬럼이 늘어나야해서 집계함수 사용이 어렵다
	3. 노드 삭제가 어렵다(복잡 위험)

2. 재귀적 쿼리도 있음.

## 해법

### 경로열거

Path 라는 컬럼을 추가해서 경로를 입력 (디렉토리 구조 처럼)
하지만 검증 비용이 많고  애플리케이션 레벨에서 만들어지기 떄문에 의존적이며
무단횡단 < 의 단점을 많이 공유한다.

### 중첩집합

nsleft, nsright 컬럼추가
사용법: DFS 로 탐색하며 내려가면서nsleft값을 입력하고 다시 올라오면서 nsright 값을 입력한다.

강점: 부모노드를 삭제해도 할아버지 노드와 자식 노드가 새롭게 부모자식으로 이어진다

그 외에는 모든 사용법이 너무 복잡하다

### 클로저테이블

새로이 테이블을 생성한다. 
이 테이블은 조상 자손 관계 또는 경로까지 담고있다.
